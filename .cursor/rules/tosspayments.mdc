# 토스페이먼츠 결제 시스템 개발 규칙

## 파일 구조
- `src/lib/toss-payments.ts`: 토스페이먼츠 SDK 설정
- `src/hooks/usePayment.ts`: 결제 관련 훅
- `src/components/payment/`: 결제 관련 컴포넌트들
- `src/app/api/payments/`: 결제 관련 API 라우트

## 환경 변수
```env
# 테스트 환경
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_*
TOSS_SECRET_KEY=test_sk_*

# 프로덕션 환경 (실제 키로 교체 필요)
NEXT_PUBLIC_TOSS_CLIENT_KEY=live_ck_*
TOSS_SECRET_KEY=live_sk_*
```

## 결제 흐름
1. 결제 정보 입력 (상품명, 금액, 주문번호)
2. 토스페이먼츠 결제창 호출
3. 결제 승인 요청 (서버 사이드)
4. 결제 결과 처리 및 사용자 안내

## 결제 훅 구조
```typescript
interface PaymentData {
  amount: number;
  orderId: string;
  orderName: string;
  customerName?: string;
  customerEmail?: string;
}

interface UsePaymentReturn {
  requestPayment: (data: PaymentData) => Promise<void>;
  loading: boolean;
  error: string | null;
}
```

## 보안 규칙
- 결제 승인은 반드시 서버에서 처리
- 클라이언트에서는 결제 요청만 수행
- 주문번호는 UUID 등 예측 불가능한 값 사용
- 결제 금액 조작 방지를 위한 서버 검증 필수

## 에러 처리
- 결제 실패 시 사용자에게 명확한 안내
- 네트워크 오류, 카드 오류 등 구분하여 처리
- 결제 취소/환불 프로세스 구현

## 테스트 카드 정보
```
카드번호: 4330-1234-1234-1234
유효기간: 아무 미래 날짜
CVC: 아무 3자리 숫자
```

## API 구조 예시
```typescript
// POST /api/payments/confirm
{
  paymentKey: string;
  orderId: string;
  amount: number;
}
```

## 로깅 및 모니터링
- 모든 결제 요청/응답 로그 저장
- 결제 실패 케이스 모니터링
- 결제 완료율 추적
description:
globs:
alwaysApply: false
---
